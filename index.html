<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SLTMobitel SME ‚Äì Project Dashboard</title>
    <style>
        /* =========================================
           MODERN CSS SECTION
           ========================================= */
        :root {
            /* Brand Colors */
            --primary-blue: #005eb8;
            --primary-dark: #004a94;
            --primary-green: #8cc63f;
            --primary-green-dark: #76b030;
            
            /* UI Colors */
            --bg-body: #f3f5f9;
            --bg-card: #ffffff;
            --bg-sidebar: #0f172a; /* Dark Navy Sidebar */
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border-light: #e2e8f0;

            /* Accents */
            --success-bg: #dcfce7;
            --success-text: #166534;
            --warning-bg: #fef9c3;
            --warning-text: #854d0e;
            --danger-bg: #fee2e2;
            --danger-text: #991b1b;

            /* Dimensions */
            --sidebar-width: 260px;
            --sidebar-width-collapsed: 80px;
            --header-height: 75px;
            --radius: 16px;
            
            /* Shadows & Gradients */
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);
            --gradient-blue: linear-gradient(135deg, #005eb8 0%, #003366 100%);
            --gradient-green: linear-gradient(135deg, #8cc63f 0%, #6a9a2a 100%);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
        }

        /* --- Layout --- */
        .app-container {
            display: grid;
            grid-template-columns: var(--sidebar-width) 1fr;
            grid-template-rows: var(--header-height) 1fr;
            height: 100vh;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body.collapsed .app-container { grid-template-columns: var(--sidebar-width-collapsed) 1fr; }

        /* --- Header --- */
        .header {
            grid-column: 2 / 3;
            grid-row: 1 / 2;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            border-bottom: 1px solid var(--border-light);
            z-index: 20;
        }

        .menu-toggle {
            cursor: pointer;
            font-size: 1.4rem;
            color: var(--text-main);
            padding: 8px;
            border-radius: 8px;
            transition: background 0.2s;
        }
        .menu-toggle:hover { background: var(--bg-body); }

        .page-title { font-size: 1.25rem; font-weight: 700; color: var(--text-main); letter-spacing: -0.5px; }

        .header-right { display: flex; align-items: center; gap: 25px; }
        
        .user-profile { display: flex; align-items: center; gap: 12px; }
        .user-avatar {
            width: 40px; height: 40px;
            border-radius: 50%;
            background: var(--gradient-blue);
            color: white;
            display: flex; align-items: center; justify-content: center;
            font-weight: 600; font-size: 0.9rem;
            box-shadow: 0 4px 10px rgba(0,94,184,0.3);
        }

        /* --- Sidebar --- */
        .sidebar {
            grid-column: 1 / 2; grid-row: 1 / 3;
            background: var(--bg-sidebar);
            color: #94a3b8;
            display: flex; flex-direction: column;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
        }

        .logo-area {
            height: var(--header-height);
            display: flex; align-items: center; justify-content: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .logo-img { height: 32px; width: auto; transition: opacity 0.2s; }
        
        body.collapsed .logo-img { opacity: 0; display: none; }
        body.collapsed .logo-icon { display: block; } /* Fallback icon if needed */
        body:not(.collapsed) .logo-icon { display: none; }

        .nav-menu { 
            list-style: none; 
            padding: 20px 15px; 
            display: flex; flex-direction: column; 
            gap: 5px; 
            height: 100%; 
        }

        /* Spacer to push bottom item down */
        .nav-spacer { flex-grow: 1; }

        .nav-item {
            padding: 12px 16px;
            display: flex; align-items: center;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .nav-item:hover { background: rgba(255,255,255,0.05); color: white; }

        .nav-item.active {
            background: rgba(0, 94, 184, 0.15);
            color: #60a5fa; 
            box-shadow: 0 0 15px rgba(0, 94, 184, 0.1);
        }
        
        .nav-item.active .nav-icon { color: #60a5fa; }
        
        /* Special style for the bottom toggle button */
        .nav-item.toggle-btn {
            margin-top: auto;
            color: var(--text-muted);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .nav-item.toggle-btn:hover { background: rgba(255,255,255,0.1); }

        .nav-icon { min-width: 24px; font-size: 1.2rem; text-align: center; margin-right: 15px; transition: color 0.2s; }
        .nav-text { white-space: nowrap; opacity: 1; transition: opacity 0.2s; }

        body.collapsed .nav-text { display: none; }
        body.collapsed .nav-item { justify-content: center; padding: 12px 0; }
        body.collapsed .nav-icon { margin-right: 0; }

        /* --- Main Content --- */
        .main-content {
            grid-column: 2 / 3; grid-row: 2 / 3;
            padding: 30px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        /* --- KPI Cards --- */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 25px; margin-bottom: 30px; }

        .kpi-card {
            background: var(--bg-card);
            padding: 24px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            display: flex; align-items: center; justify-content: space-between;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 1px solid var(--border-light);
            position: relative;
            overflow: hidden;
        }
        
        .kpi-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); }
        .kpi-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; }
        .kpi-blue::before { background: var(--primary-blue); }
        .kpi-green::before { background: var(--primary-green); }
        .kpi-orange::before { background: #f59e0b; }
        .kpi-red::before { background: #ef4444; }

        .kpi-info h3 { font-size: 0.85rem; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .kpi-info .number { font-size: 2rem; font-weight: 700; color: var(--text-main); }

        .kpi-icon { width: 52px; height: 52px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .kpi-blue .kpi-icon { background: #eff6ff; color: var(--primary-blue); }
        .kpi-green .kpi-icon { background: #f0fdf4; color: var(--primary-green); }
        .kpi-orange .kpi-icon { background: #fffbeb; color: #f59e0b; }
        .kpi-red .kpi-icon { background: #fef2f2; color: #ef4444; }

        /* --- Charts --- */
        .charts-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; margin-bottom: 30px; }
        .chart-card { background: var(--bg-card); padding: 24px; border-radius: var(--radius); box-shadow: var(--shadow-sm); border: 1px solid var(--border-light); }
        .chart-header { margin-bottom: 20px; font-size: 1.1rem; font-weight: 700; color: var(--text-main); }

        .donut-chart {
            width: 180px; height: 180px; border-radius: 50%;
            margin: 0 auto; position: relative;
            background: conic-gradient(var(--primary-blue) 0deg 200deg, var(--primary-green) 200deg 300deg, #f59e0b 300deg 360deg);
            display: flex; align-items: center; justify-content: center;
        }
        .donut-inner { width: 120px; height: 120px; background: var(--bg-card); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        .donut-val { font-size: 1.5rem; font-weight: 700; color: var(--text-main); }
        .donut-label { font-size: 0.75rem; color: var(--text-muted); }

        .chart-container { width: 100%; height: 240px; display: flex; align-items: flex-end; justify-content: space-around; padding-top: 20px; }
        .bar-group { display: flex; flex-direction: column; align-items: center; width: 100%; gap: 10px; }
        .bar { width: 40px; border-radius: 6px 6px 0 0; background: var(--gradient-blue); transition: height 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); position: relative; }
        .bar:hover { opacity: 0.9; transform: scaleX(1.1); }
        .bar-label { font-size: 0.8rem; color: var(--text-muted); font-weight: 500; }

        /* --- Tables --- */
        .table-card { background: var(--bg-card); padding: 24px; border-radius: var(--radius); box-shadow: var(--shadow-sm); border: 1px solid var(--border-light); margin-bottom: 30px; overflow: hidden; }
        table { width: 100%; border-collapse: separate; border-spacing: 0; min-width: 900px; }
        
        th { padding: 16px 20px; text-align: left; background: #f8fafc; color: var(--text-muted); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; border-bottom: 2px solid var(--border-light); }
        td { padding: 16px 20px; border-bottom: 1px solid #f1f5f9; font-size: 0.9rem; vertical-align: middle; white-space: nowrap; }
        tr:last-child td { border-bottom: none; }
        tr:hover td { background: #f8fafc; }

        .status-badge { padding: 6px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; letter-spacing: 0.3px; }
        .status-active { background: var(--success-bg); color: var(--success-text); }
        .status-delayed { background: var(--warning-bg); color: var(--warning-text); }
        .status-completed { background: #eff6ff; color: var(--primary-blue); }

        .progress-bar { width: 100%; background: #f1f5f9; height: 8px; border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--gradient-blue); width: 0%; border-radius: 10px; transition: width 0.5s ease; }

        /* Buttons & Inputs */
        .btn { padding: 10px 20px; border: none; border-radius: 30px; cursor: pointer; font-weight: 600; font-size: 0.9rem; display: inline-flex; align-items: center; gap: 8px; transition: all 0.2s; }
        .btn-primary { background: var(--gradient-blue); color: white; box-shadow: 0 4px 12px rgba(0, 94, 184, 0.25); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0, 94, 184, 0.35); }
        .btn-secondary { background: #f1f5f9; color: var(--text-muted); }
        .btn-secondary:hover { background: #e2e8f0; }

        .edit-input { width: 100%; padding: 8px 12px; border: 1px solid var(--border-light); border-radius: 8px; font-size: 0.85rem; transition: border-color 0.2s; background: #fff; }
        .edit-input:focus { outline: none; border-color: var(--primary-blue); box-shadow: 0 0 0 3px rgba(0, 94, 184, 0.1); }

        .action-btn { background: none; border: none; cursor: pointer; font-size: 1.1rem; margin-right: 6px; transition: transform 0.2s; }
        .action-btn:hover { transform: scale(1.15); }
        .btn-edit { color: var(--primary-blue); }
        .btn-delete { color: #ef4444; }
        .btn-save { color: #10b981; }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.4); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        .modal { background: var(--bg-card); width: 90%; max-width: 500px; border-radius: 20px; box-shadow: var(--shadow-lg); transform: scale(0.95); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); overflow: hidden; }
        .modal-overlay.active .modal { transform: scale(1); }
        .modal-header { padding: 24px; border-bottom: 1px solid var(--border-light); display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 24px; }
        .modal-footer { padding: 16px 24px; background: #f8fafc; border-top: 1px solid var(--border-light); display: flex; justify-content: flex-end; gap: 12px; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; color: var(--text-main); }
        .form-control { width: 100%; padding: 12px; border: 1px solid var(--border-light); border-radius: 10px; font-size: 0.95rem; transition: 0.2s; }
        .form-control:focus { outline: none; border-color: var(--primary-blue); }

        /* Toast */
        .toast-container { position: fixed; bottom: 24px; right: 24px; z-index: 2000; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: #1e293b; color: white; padding: 12px 24px; border-radius: 12px; box-shadow: var(--shadow-lg); animation: slideIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); display: flex; align-items: center; gap: 10px; }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Responsive Table Wrapper */
        .table-wrapper { overflow-x: auto; }

        /* Mobile */
        @media (max-width: 768px) {
            .app-container { grid-template-columns: 1fr; grid-template-rows: var(--header-height) 1fr; }
            .sidebar { position: fixed; left: -100%; width: 260px; height: 100%; z-index: 50; }
            .sidebar.active { left: 0; }
            .header { grid-column: 1 / 2; padding: 0 20px; }
            .main-content { grid-column: 1 / 2; padding: 20px; }
            body.collapsed .app-container { grid-template-columns: 1fr; }
            /* Hide sidebar minimize button on mobile */
            .toggle-btn { display: none; }
        }
    </style>
</head>
<body>

    <div class="app-container">
        <!-- SIDEBAR -->
        <aside class="sidebar" id="sidebar">
            <div class="logo-area">
                <!-- Fallback icon for collapsed state (optional, currently hiding img) -->
                <div class="logo-icon" style="display:none; font-size:1.5rem; font-weight:bold; color:white;">S</div>
                <img src="https://z-cdn-media.chatglm.cn/files/7072dd57-367e-4bee-bbf8-35ee315099e0.png?auth_key=1869643420-b5d10f105d054e55818bed6b4d8165b0-0-473e31fe5e2f573e26295424141a1ef4" alt="SLTMobitel" class="logo-img">
            </div>

            <ul class="nav-menu">
                <li class="nav-item active" onclick="app.navigate('dashboard')">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-text">Dashboard</span>
                </li>
                <li class="nav-item" onclick="app.navigate('projects')">
                    <span class="nav-icon">üöÄ</span>
                    <span class="nav-text">Projects</span>
                </li>
                <li class="nav-item" onclick="app.openModal('project')">
                    <span class="nav-icon">‚ûï</span>
                    <span class="nav-text">New Project</span>
                </li>
                <li class="nav-item" onclick="app.navigate('daily')">
                    <span class="nav-icon">üìù</span>
                    <span class="nav-text">Daily Work</span>
                </li>
                <li class="nav-item" onclick="app.navigate('team')">
                    <span class="nav-icon">üë•</span>
                    <span class="nav-text">Team</span>
                </li>
                <li class="nav-item" onclick="app.navigate('reports')">
                    <span class="nav-icon">üìà</span>
                    <span class="nav-text">Analytics</span>
                </li>

                <!-- Spacer to push toggle to bottom -->
                <li class="nav-spacer"></li>

                <!-- Sidebar Minimize/Maximize Button -->
                <li class="nav-item toggle-btn" onclick="app.toggleSidebar()">
                    <span class="nav-icon" id="sideToggleIcon">‚ùÆ</span>
                    <span class="nav-text" id="sideToggleText">Collapse</span>
                </li>
            </ul>
        </aside>

        <!-- HEADER -->
        <header class="header">
            <div style="display:flex; align-items:center; gap:20px;">
                <!-- Header Toggle (Changes icons based on state) -->
                <div class="menu-toggle" id="headerToggleIcon" onclick="app.toggleSidebar()">‚ò∞</div>
                <div class="page-title" id="pageTitle">Dashboard</div>
            </div>
            <div class="header-right">
                <div class="user-profile">
                    <div style="text-align:right; display:none; @media(min-width:768px){display:block;}">
                        <div style="font-weight:700; font-size:0.9rem;">Admin User</div>
                        <div style="font-size:0.75rem; color:var(--text-muted);">Manager</div>
                    </div>
                    <div class="user-avatar">AD</div>
                </div>
            </div>
        </header>

        <!-- MAIN CONTENT -->
        <main class="main-content" id="mainContent">
            <!-- JS Injection -->
        </main>

    </div>

    <!-- MODAL -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle" style="font-size:1.25rem;">Add New Item</h3>
                <span style="cursor:pointer; font-size:1.5rem; color:var(--text-muted);" onclick="app.closeModal()">√ó</span>
            </div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeModal()">Cancel</button>
                <button class="btn btn-primary" id="modalSaveBtn">Save</button>
            </div>
        </div>
    </div>

    <!-- TOAST -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        const app = (function() {
            // Data
            const defaultData = {
                projects: [
                    { id: "P-001", name: "Fiber Network Upgrade", startDay: "2026-01-25", endDay: "2026-02-10", workDuration: 16, team: "N. Perera, S. Silva", status: "Active", progress: 60 },
                    { id: "P-002", name: "SLT 5G Deployment", startDay: "2026-01-10", endDay: "2026-03-15", workDuration: 65, team: "K. Jayawardena", status: "Delayed", progress: 30 },
                    { id: "P-003", name: "SME Server Migration", startDay: "2026-01-01", endDay: "2026-01-20", workDuration: 20, team: "A. Fernando", status: "Completed", progress: 100 }
                ],
                dailyWork: [
                    { id: "DW-001", date: "2026-01-28", project: "Fiber Network Upgrade", peopleWorked: 2, workDuration: 8, status: "Active" },
                    { id: "DW-002", date: "2026-01-28", project: "SLT 5G Deployment", peopleWorked: 4, workDuration: 8, status: "Delayed" }
                ],
                teamMembers: [
                    { id: "TM-01", name: "N. Perera", role: "Network Engineer", skill: "Fiber", project: "Fiber Network Upgrade", status: "Active", todayWorking: true, contact: "0711234567" },
                    { id: "TM-02", name: "S. Silva", role: "Technician", skill: "HW", project: "Fiber Network Upgrade", status: "Active", todayWorking: true, contact: "0779876543" }
                ]
            };

            let state = JSON.parse(localStorage.getItem('sltSmeData')) || defaultData;
            let currentView = 'dashboard';

            // DOM Elements
            const mainContent = document.getElementById('mainContent');
            const pageTitle = document.getElementById('pageTitle');
            const sidebar = document.getElementById('sidebar');
            const modalOverlay = document.getElementById('modalOverlay');

            function saveData() {
                localStorage.setItem('sltSmeData', JSON.stringify(state));
                renderCurrentView();
            }

            // --- Render Views ---

            function renderDashboard() {
                pageTitle.innerText = "Dashboard";
                const total = state.projects.length;
                const active = state.projects.filter(p => p.status === 'Active').length;
                const completed = state.projects.filter(p => p.status === 'Completed').length;
                const delayed = state.projects.filter(p => p.status === 'Delayed').length;

                mainContent.innerHTML = `
                    <div class="dashboard-grid">
                        <div class="kpi-card kpi-blue">
                            <div class="kpi-info"><h3>Total Projects</h3><div class="number">${total}</div></div>
                            <div class="kpi-icon">üìÅ</div>
                        </div>
                        <div class="kpi-card kpi-green">
                            <div class="kpi-info"><h3>Active</h3><div class="number">${active}</div></div>
                            <div class="kpi-icon">‚ö°</div>
                        </div>
                        <div class="kpi-card kpi-orange">
                            <div class="kpi-info"><h3>Delayed</h3><div class="number">${delayed}</div></div>
                            <div class="kpi-icon">‚ö†Ô∏è</div>
                        </div>
                        <div class="kpi-card kpi-blue">
                            <div class="kpi-info"><h3>Completed</h3><div class="number">${completed}</div></div>
                            <div class="kpi-icon">‚úÖ</div>
                        </div>
                    </div>

                    <div class="charts-row">
                        <div class="chart-card">
                            <div class="chart-header">Project Status</div>
                            <div style="height: 220px; display: flex; align-items: center; justify-content: center;">
                                <div class="donut-chart" id="donutChart"></div>
                            </div>
                            <div style="display:flex; justify-content:center; gap:15px; margin-top:15px; font-size:0.8rem;">
                                <span style="color:var(--primary-blue)">‚óè Active</span>
                                <span style="color:var(--primary-green)">‚óè Done</span>
                                <span style="color:#f59e0b">‚óè Delay</span>
                            </div>
                        </div>
                        <div class="chart-card">
                            <div class="chart-header">Workload Distribution</div>
                            <div class="chart-container" id="barChart"></div>
                        </div>
                    </div>

                    <div class="table-card">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                            <h3 style="font-size:1.1rem; font-weight:700;">Recent Projects</h3>
                            <button class="btn btn-primary" style="padding:6px 16px; font-size:0.8rem;" onclick="app.openModal('project')">+ New</button>
                        </div>
                        <div class="table-wrapper">
                            <table>
                                <thead><tr><th>Project</th><th>Start</th><th>End</th><th>Days</th><th>Status</th><th>Progress</th><th>Action</th></tr></thead>
                                <tbody>
                                    ${state.projects.map(p => renderProjectRow(p)).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                updateCharts(active, completed, delayed);
            }

            function renderProjectRow(p) {
                return `
                    <tr id="row-${p.id}">
                        <td style="min-width: 200px;">
                            <span class="view-mode"><strong>${p.name}</strong></span>
                            <input type="text" class="edit-input edit-mode" data-field="name" value="${p.name}" style="display:none">
                        </td>
                        <td>
                            <span class="view-mode">${p.startDay}</span>
                            <input type="date" class="edit-input edit-mode" data-field="startDay" value="${p.startDay}" style="display:none">
                        </td>
                        <td>
                            <span class="view-mode">${p.endDay}</span>
                            <input type="date" class="edit-input edit-mode" data-field="endDay" value="${p.endDay}" style="display:none">
                        </td>
                         <td>
                            <span class="view-mode"><strong>${p.workDuration}</strong> days</span>
                            <input type="number" class="edit-input edit-mode" data-field="workDuration" value="${p.workDuration}" style="display:none">
                        </td>
                        <td>
                            <span class="status-badge ${p.status === 'Active' ? 'status-active' : (p.status==='Completed'?'status-completed':'status-delayed')} view-mode">${p.status}</span>
                            <select class="edit-input edit-mode" data-field="status" style="display:none">
                                <option value="Active" ${p.status === 'Active'?'selected':''}>Active</option>
                                <option value="Completed" ${p.status === 'Completed'?'selected':''}>Completed</option>
                                <option value="Delayed" ${p.status === 'Delayed'?'selected':''}>Delayed</option>
                            </select>
                        </td>
                        <td style="min-width:140px;">
                            <div class="progress-bar view-mode"><div class="progress-fill" style="width:${p.progress}%"></div></div>
                            <input type="number" class="edit-input edit-mode" data-field="progress" value="${p.progress}" style="display:none">
                        </td>
                        <td>
                            <button class="action-btn btn-edit view-mode" onclick="app.toggleEdit('${p.id}', 'project')">‚úé</button>
                            <button class="action-btn btn-delete view-mode" onclick="app.deleteItem('${p.id}', 'project')">üóë</button>
                            <button class="action-btn btn-save edit-mode" style="display:none" onclick="app.saveEdit('${p.id}', 'project')">üíæ</button>
                            <button class="action-btn btn-cancel edit-mode" style="display:none" onclick="app.cancelEdit('${p.id}', 'project')">‚úï</button>
                        </td>
                    </tr>
                `;
            }

            function renderProjectsPage() {
                pageTitle.innerText = "All Projects";
                mainContent.innerHTML = `
                    <div class="table-card">
                         <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                            <h3 style="font-size:1.1rem; font-weight:700;">Project List</h3>
                            <button class="btn btn-primary" onclick="app.openModal('project')">+ Add Project</button>
                        </div>
                        <div class="table-wrapper">
                             <table>
                                <thead><tr><th>Project</th><th>Team</th><th>Start</th><th>End</th><th>Days</th><th>Status</th><th>Progress</th><th>Action</th></tr></thead>
                                <tbody>
                                    ${state.projects.map(p => `
                                    <tr id="row-${p.id}">
                                        <td style="min-width: 200px;">
                                            <span class="view-mode"><strong>${p.name}</strong></span>
                                            <input type="text" class="edit-input edit-mode" data-field="name" value="${p.name}" style="display:none">
                                        </td>
                                        <td style="min-width: 150px;">
                                            <span class="view-mode">${p.team}</span>
                                            <input type="text" class="edit-input edit-mode" data-field="team" value="${p.team}" style="display:none">
                                        </td>
                                        <td>
                                            <span class="view-mode">${p.startDay}</span>
                                            <input type="date" class="edit-input edit-mode" data-field="startDay" value="${p.startDay}" style="display:none">
                                        </td>
                                        <td>
                                            <span class="view-mode">${p.endDay}</span>
                                            <input type="date" class="edit-input edit-mode" data-field="endDay" value="${p.endDay}" style="display:none">
                                        </td>
                                         <td>
                                            <span class="view-mode">${p.workDuration}</span>
                                            <input type="number" class="edit-input edit-mode" data-field="workDuration" value="${p.workDuration}" style="display:none">
                                        </td>
                                        <td>
                                            <span class="status-badge ${p.status === 'Active' ? 'status-active' : (p.status==='Completed'?'status-completed':'status-delayed')} view-mode">${p.status}</span>
                                            <select class="edit-input edit-mode" data-field="status" style="display:none">
                                                <option value="Active" ${p.status === 'Active'?'selected':''}>Active</option>
                                                <option value="Completed" ${p.status === 'Completed'?'selected':''}>Completed</option>
                                                <option value="Delayed" ${p.status === 'Delayed'?'selected':''}>Delayed</option>
                                            </select>
                                        </td>
                                        <td style="min-width:140px;">
                                            <div class="progress-bar view-mode"><div class="progress-fill" style="width:${p.progress}%"></div></div>
                                            <input type="number" class="edit-input edit-mode" data-field="progress" value="${p.progress}" style="display:none">
                                        </td>
                                        <td>
                                            <button class="action-btn btn-edit view-mode" onclick="app.toggleEdit('${p.id}', 'project')">‚úé</button>
                                            <button class="action-btn btn-delete view-mode" onclick="app.deleteItem('${p.id}', 'project')">üóë</button>
                                            <button class="action-btn btn-save edit-mode" style="display:none" onclick="app.saveEdit('${p.id}', 'project')">üíæ</button>
                                            <button class="action-btn btn-cancel edit-mode" style="display:none" onclick="app.cancelEdit('${p.id}', 'project')">‚úï</button>
                                        </td>
                                    </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }
            
            function renderTeamPage() {
                pageTitle.innerText = "Team Members";
                mainContent.innerHTML = `
                    <div class="table-card">
                         <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                            <h3 style="font-size:1.1rem; font-weight:700;">Team Directory</h3>
                            <button class="btn btn-primary" onclick="app.openModal('team')">+ Add Member</button>
                        </div>
                         <div class="table-wrapper">
                            <table>
                                <thead><tr><th>Name</th><th>Role</th><th>Project</th><th>Status</th><th>Action</th></tr></thead>
                                <tbody>
                                    ${state.teamMembers.map(m => `
                                        <tr id="row-${m.id}">
                                            <td>
                                                <div class="view-mode"><strong>${m.name}</strong><div style="font-size:0.75rem; color:var(--text-muted)">${m.skill}</div></div>
                                                <input type="text" class="edit-input edit-mode" data-field="name" value="${m.name}" style="display:none">
                                            </td>
                                            <td>${m.role}</td>
                                            <td>
                                                <span class="status-badge status-active view-mode" style="background:#f1f5f9; color:var(--text-main);">${m.project}</span>
                                            </td>
                                            <td>
                                                <span class="status-badge ${m.todayWorking?'status-active':'status-delayed'} view-mode">${m.todayWorking?'Working':'Off'}</span>
                                                <select class="edit-input edit-mode" data-field="todayWorking" style="display:none">
                                                    <option value="true" ${m.todayWorking?'selected':''}>Working</option>
                                                    <option value="false" ${!m.todayWorking?'selected':''}>Off</option>
                                                </select>
                                            </td>
                                             <td>
                                                <button class="action-btn btn-edit view-mode" onclick="app.toggleEdit('${m.id}', 'team')">‚úé</button>
                                                <button class="action-btn btn-delete view-mode" onclick="app.deleteItem('${m.id}', 'team')">üóë</button>
                                                <button class="action-btn btn-save edit-mode" style="display:none" onclick="app.saveEdit('${m.id}', 'team')">üíæ</button>
                                                <button class="action-btn btn-cancel edit-mode" style="display:none" onclick="app.cancelEdit('${m.id}', 'team')">‚úï</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            function renderDailyPage() {
                pageTitle.innerText = "Daily Logs";
                mainContent.innerHTML = `
                    <div class="table-card">
                         <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                            <h3 style="font-size:1.1rem; font-weight:700;">Work Logs</h3>
                            <button class="btn btn-primary" onclick="app.openModal('daily')">+ Add Log</button>
                        </div>
                        <div class="table-wrapper">
                            <table>
                                <thead><tr><th>Date</th><th>Project</th><th>People</th><th>Duration</th><th>Action</th></tr></thead>
                                <tbody>
                                    ${state.dailyWork.map(d => `
                                        <tr id="row-${d.id}">
                                            <td>
                                                <span class="view-mode">${d.date}</span>
                                                <input type="date" class="edit-input edit-mode" data-field="date" value="${d.date}" style="display:none">
                                            </td>
                                            <td>
                                                <span class="view-mode">${d.project}</span>
                                                <select class="edit-input edit-mode" data-field="project" style="display:none">
                                                    ${state.projects.map(p => `<option value="${p.name}" ${p.name === d.project?'selected':''}>${p.name}</option>`).join('')}
                                                </select>
                                            </td>
                                            <td>
                                                <span class="view-mode">${d.peopleWorked}</span>
                                                <input type="number" class="edit-input edit-mode" data-field="peopleWorked" value="${d.peopleWorked}" style="display:none">
                                            </td>
                                            <td>
                                                <span class="view-mode">${d.workDuration}h</span>
                                                <input type="number" class="edit-input edit-mode" data-field="workDuration" value="${d.workDuration}" style="display:none">
                                            </td>
                                            <td>
                                                <button class="action-btn btn-edit view-mode" onclick="app.toggleEdit('${d.id}', 'daily')">‚úé</button>
                                                <button class="action-btn btn-delete view-mode" onclick="app.deleteItem('${d.id}', 'daily')">üóë</button>
                                                <button class="action-btn btn-save edit-mode" style="display:none" onclick="app.saveEdit('${d.id}', 'daily')">üíæ</button>
                                                <button class="action-btn btn-cancel edit-mode" style="display:none" onclick="app.cancelEdit('${d.id}', 'daily')">‚úï</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            // --- Chart Logic ---
            function updateCharts(active, completed, delayed) {
                const total = active + completed + delayed;
                if(!total) return;
                const aDeg = (active/total)*360;
                const cDeg = aDeg + (completed/total)*360;
                
                // Donut Chart Update
                const donut = document.getElementById('donutChart');
                if(donut) {
                    donut.style.background = `conic-gradient(
                        #005eb8 0deg ${aDeg}deg,
                        #8cc63f ${aDeg}deg ${cDeg}deg,
                        #f59e0b ${cDeg}deg 360deg
                    )`;
                    donut.innerHTML = `<div class="donut-inner"><div class="donut-val">${total}</div><div class="donut-label">Projects</div></div>`;
                }

                // Bar Chart Update
                const barContainer = document.getElementById('barChart');
                if(barContainer) {
                    const pCounts = {};
                    state.dailyWork.forEach(d => pCounts[d.project] = (pCounts[d.project]||0) + parseInt(d.peopleWorked));
                    const max = Math.max(...Object.values(pCounts), 5);
                    
                    barContainer.innerHTML = Object.keys(pCounts).map(k => {
                        const h = (pCounts[k]/max)*100;
                        return `
                            <div class="bar-group">
                                <div class="bar" style="height:${h}%"></div>
                                <span class="bar-label">${k.substring(0,8)}...</span>
                            </div>
                        `;
                    }).join('');
                }
            }

            // --- Navigation ---
            function navigate(view) {
                currentView = view;
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                const items = document.querySelectorAll('.nav-item');
                if(view==='dashboard') items[0].classList.add('active');
                if(view==='projects') items[1].classList.add('active');
                if(view==='daily') items[3].classList.add('active');
                if(view==='team') items[4].classList.add('active');
                if(window.innerWidth<=768) sidebar.classList.remove('active');
                renderCurrentView();
            }

            function renderCurrentView() {
                if(currentView === 'dashboard') renderDashboard();
                else if(currentView === 'projects') renderProjectsPage();
                else if(currentView === 'team') renderTeamPage();
                else if(currentView === 'daily') renderDailyPage();
                else { mainContent.innerHTML = `<div style="text-align:center; padding:50px; color:var(--text-muted);">Feature under development</div>`; }
            }

            // --- Actions ---
            function toggleEdit(id, type) {
                const row = document.getElementById(`row-${id}`);
                row.querySelectorAll('.view-mode').forEach(e => e.style.display='none');
                row.querySelectorAll('.edit-mode').forEach(e => e.style.display='block');
            }
            
            function cancelEdit(id, type) { renderCurrentView(); }
            
            function saveEdit(id, type) {
                const row = document.getElementById(`row-${id}`);
                let obj;
                if(type==='project') obj = state.projects.find(i=>i.id===id);
                if(type==='team') obj = state.teamMembers.find(i=>i.id===id);
                if(type==='daily') obj = state.dailyWork.find(i=>i.id===id);
                
                row.querySelectorAll('.edit-mode').forEach(inp => {
                    const f = inp.dataset.field;
                    if(f==='todayWorking') obj[f] = inp.value==='true';
                    else if(f==='progress') obj[f] = parseInt(inp.value);
                    else obj[f] = inp.value;
                });
                saveData();
                showToast("Saved Successfully");
            }

            function deleteItem(id, type) {
                if(!confirm("Delete this item?")) return;
                if(type==='project') state.projects = state.projects.filter(i=>i.id!==id);
                if(type==='team') state.teamMembers = state.teamMembers.filter(i=>i.id!==id);
                if(type==='daily') state.dailyWork = state.dailyWork.filter(i=>i.id!==id);
                saveData();
                showToast("Item Deleted");
            }

            // --- Modal Logic ---
            function openModal(type) {
                modalOverlay.classList.add('active');
                const body = document.getElementById('modalBody');
                const btn = document.getElementById('modalSaveBtn');
                
                if(type==='project') {
                    document.getElementById('modalTitle').innerText="New Project";
                    body.innerHTML = `
                        <div class="form-group"><label>Project Name</label><input id="nName" class="form-control" placeholder="e.g. Network Upgrade"></div>
                        
                        <div class="form-group"><label>Start Day</label>
                            <input type="date" id="nStart" class="form-control" onchange="app.calcDays()">
                        </div>
                        
                        <div class="form-group"><label>End Day</label>
                            <input type="date" id="nEnd" class="form-control" onchange="app.calcDays()">
                        </div>
                        
                        <div class="form-group"><label>Work Days (Duration)</label>
                            <input type="number" id="nDays" class="form-control" placeholder="0">
                        </div>

                        <div class="form-group"><label>Team Members</label><input id="nTeam" class="form-control" placeholder="Names separated by comma"></div>
                    `;
                    
                    btn.onclick = () => {
                        const name = document.getElementById('nName').value;
                        const start = document.getElementById('nStart').value;
                        const end = document.getElementById('nEnd').value;
                        const days = document.getElementById('nDays').value;
                        const team = document.getElementById('nTeam').value;

                        if(!name || !start || !end) { alert("Please fill required fields"); return; }

                        state.projects.push({
                            id: 'P-'+Date.now(), 
                            name: name,
                            startDay: start,
                            endDay: end,
                            workDuration: days || 10,
                            team: team,
                            status:'Active', 
                            progress:0
                        });
                        saveData(); closeModal(); showToast("Project Added");
                    };
                } else if (type==='team') {
                    document.getElementById('modalTitle').innerText="New Member";
                    body.innerHTML = `
                        <div class="form-group"><label>Name</label><input id="tName" class="form-control"></div>
                        <div class="form-group"><label>Role</label><input id="tRole" class="form-control"></div>
                        <div class="form-group"><label>Skill</label><input id="tSkill" class="form-control"></div>
                    `;
                    btn.onclick = () => {
                        state.teamMembers.push({
                            id: 'TM-'+Date.now(), name:document.getElementById('tName').value,
                            role:document.getElementById('tRole').value, skill:document.getElementById('tSkill').value,
                            project:state.projects[0] ? state.projects[0].name : 'Unassigned', status:'Active', todayWorking:true, contact:''
                        });
                        saveData(); closeModal(); showToast("Added");
                    };
                } else if (type==='daily') {
                    document.getElementById('modalTitle').innerText="New Log";
                    body.innerHTML = `
                         <div class="form-group"><label>Project</label><select id="dProj" class="form-control">${state.projects.map(p=>`<option>${p.name}</option>`)}</select></div>
                         <div class="form-group"><label>People Count</label><input type="number" id="dCount" class="form-control" value="1"></div>
                    `;
                    btn.onclick = () => {
                        state.dailyWork.push({
                            id:'DW-'+Date.now(), date:new Date().toISOString().split('T')[0],
                            project:document.getElementById('dProj').value, peopleWorked:parseInt(document.getElementById('dCount').value),
                            workDuration:8, status:'Active'
                        });
                        saveData(); closeModal(); showToast("Added");
                    };
                }
            }

            // Helper for auto-calculation
            function calcDays() {
                const start = new Date(document.getElementById('nStart').value);
                const end = new Date(document.getElementById('nEnd').value);
                const input = document.getElementById('nDays');
                if(start && end && end >= start) {
                    const diff = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                    input.value = diff;
                }
            }

            // --- Sidebar Toggle Logic (New) ---
            function toggleSidebar() {
                // On mobile, toggle the drawer
                if(window.innerWidth <= 768) {
                    sidebar.classList.toggle('active');
                    return;
                }

                // On desktop, toggle collapse
                document.body.classList.toggle('collapsed');
                
                const isCollapsed = document.body.classList.contains('collapsed');
                
                // Update Sidebar Footer Icons
                const sideIcon = document.getElementById('sideToggleIcon');
                const sideText = document.getElementById('sideToggleText');

                if(isCollapsed) {
                    sideIcon.innerText = '‚ùØ'; // Right arrow
                    sideText.innerText = 'Expand';
                } else {
                    sideIcon.innerText = '‚ùÆ'; // Left arrow
                    sideText.innerText = 'Collapse';
                }

                // Update Header Icon
                const headerIcon = document.getElementById('headerToggleIcon');
                headerIcon.innerText = isCollapsed ? '‚ùÆ' : '‚ò∞';
            }

            function closeModal() { modalOverlay.classList.remove('active'); }
            function showToast(msg) {
                const t = document.createElement('div'); t.className='toast'; t.innerText=msg;
                document.getElementById('toastContainer').appendChild(t);
                setTimeout(()=>t.remove(),3000);
            }

            return { navigate, openModal, closeModal, toggleEdit, saveEdit, cancelEdit, deleteItem, showToast, calcDays, toggleSidebar };
        })();
        
        app.navigate('dashboard');
    </script>
</body>
</html>
